<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rOPTRAM: Three Trapezoid Fitting Methods • rOPTRAM</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rOPTRAM: Three Trapezoid Fitting Methods">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rOPTRAM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.0.000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../articles/rOPTRAM.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rOPTRAM_acquiring.html">Acquiring Sentinel-2 Imagery</a></li>
    <li><a class="dropdown-item" href="../articles/rOPTRAM_trapezoid_methods.html">rOPTRAM: Three Trapezoid Fitting Methods</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rOPTRAM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rOPTRAM: Three Trapezoid Fitting Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rOPTRAM/blob/master/vignettes/rOPTRAM_trapezoid_methods.Rmd" class="external-link"><code>vignettes/rOPTRAM_trapezoid_methods.Rmd</code></a></small>
      <div class="d-none name"><code>rOPTRAM_trapezoid_methods.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction
<img align="right" width="100" height="100" src="images/rOPTRAM_logo.jpg"><a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The algorithm for finding trapezoid wet and dry edges works as
follows:</p>
<p>After acquiring a time series of Sentinel-2 images over the study
area, both vegetation index (i.e. NDVI or SAVI), and SWIR Transformed
Reflectance (STR) rasters are prepared. Pixel values of both indices for
all images are collected into a two column table (and plotted as a
scatterplot). The vegetation axis (x-axis) is split into a large number
of intervals (usually between 50 - 100). The width of each interval is
configurable by the user through the <code>vi_step</code> parameter in
<code><a href="../reference/optram_wetdry_coefficients.html">optram_wetdry_coefficients()</a></code>. Then for each interval the
top and bottom 5% quantiles of STR values are determined. These point
values - VI and STR - are considered to create the fitted wet and dry
trapezoid edges.</p>
<p>Three fitting methods are available in {rOPTRAM} to prepare the
trapezoid wet and dry edges. For detailed background, see: <span class="citation">Ma, Johansen, and McCabe (2022)</span>. Users can
choose between a</p>
<ul>
<li>linear OLS fitted line</li>
<li>exponential fit</li>
<li>second order polynomial</li>
</ul>
<p>All fitting methods are derived using the <code>lm</code> function in
the <code>R</code> {stats} package.</p>
<p>The linear OLS fit follows:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>T</mi><mi>R</mi><mo>=</mo><mi>i</mi><mo>+</mo><mi>s</mi><mo>⋅</mo><mi>V</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">STR = i + s \cdot VI</annotation></semantics></math>
The exponential fit uses the equation:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>T</mi><mi>R</mi><mo>=</mo><mi>i</mi><mo>⋅</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo>⋅</mo><mi>V</mi><mi>I</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">STR = i \cdot e^{(s \cdot VI)}</annotation></semantics></math>
where STR is the fitted STR value,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
are the exponential regression intercept, and coefficient and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">VI</annotation></semantics></math>
is the vegetation index value.</p>
<p>The polynomial fit uses:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>T</mi><mi>R</mi><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><mn>1</mn><mo>⋅</mo><mi>V</mi><mi>I</mi><mo>+</mo><mi>β</mi><mn>2</mn><mo>⋅</mo><mi>V</mi><msup><mi>I</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex"> STR = \alpha + \beta1 \cdot VI + \beta2 \cdot VI^2</annotation></semantics></math></p>
<p>The fitting method is chosen by setting the
<code>trapezoid_method</code> option using the
<code><a href="../reference/optram_options.html">optram_options()</a></code> function.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/rOPTRAM"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rOPTRAM">"rOPTRAM"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://zivankaraman.github.io/CDSE/" class="external-link">"CDSE"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">"jsonlite"</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="prepare-data-frame-of-pixel-values">Prepare data.frame of pixel values<a class="anchor" aria-label="anchor" href="#prepare-data-frame-of-pixel-values"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">from_date</span> <span class="op">&lt;-</span> <span class="st">"2022-05-01"</span></span>
<span><span class="va">to_date</span> <span class="op">&lt;-</span> <span class="st">"2023-04-30"</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                            <span class="st">"lachish.gpkg"</span>, package <span class="op">=</span> <span class="st">"rOPTRAM"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/optram_options.html">optram_options</a></span><span class="op">(</span><span class="st">"veg_index"</span>, <span class="st">"NDVI"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s2_file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optram_acquire_s2.html">optram_acquire_s2</a></span><span class="op">(</span><span class="va">aoi</span>,</span>
<span>                            <span class="va">from_date</span>, <span class="va">to_date</span>,</span>
<span>                            output_dir <span class="op">=</span> <span class="va">output_dir</span><span class="op">)</span></span>
<span><span class="va">STR_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"STR"</span><span class="op">)</span>,</span>
<span>                      pattern <span class="op">=</span> <span class="st">".tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">VI_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"NDVI"</span><span class="op">)</span>,</span>
<span>                      pattern <span class="op">=</span> <span class="st">".tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">full_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optram_ndvi_str.html">optram_ndvi_str</a></span><span class="op">(</span><span class="va">STR_list</span>, <span class="va">VI_list</span>,</span>
<span>                           output_dir <span class="op">=</span> <span class="va">output_dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="show-linear-trapezoid-plot">Show Linear trapezoid plot<a class="anchor" aria-label="anchor" href="#show-linear-trapezoid-plot"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meth</span> <span class="op">&lt;-</span> <span class="st">"linear"</span></span>
<span><span class="fu"><a href="../reference/optram_options.html">optram_options</a></span><span class="op">(</span><span class="st">"trapezoid_method"</span>, <span class="va">meth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "edge_points = TRUE"</span></span>
<span><span class="co">#&gt; [1] "feature_col = ID"</span></span>
<span><span class="co">#&gt; [1] "max_cloud = 12"</span></span>
<span><span class="co">#&gt; [1] "max_tbl_size = 1e+06"</span></span>
<span><span class="co">#&gt; [1] "period = full"</span></span>
<span><span class="co">#&gt; [1] "plot_colors = no"</span></span>
<span><span class="co">#&gt; [1] "remote = scihub"</span></span>
<span><span class="co">#&gt; [1] "rm.hi.str = FALSE"</span></span>
<span><span class="co">#&gt; [1] "rm.low.vi = FALSE"</span></span>
<span><span class="co">#&gt; [1] "SWIR_band = 11"</span></span>
<span><span class="co">#&gt; [1] "trapezoid_method = linear"</span></span>
<span><span class="co">#&gt; [1] "veg_index = NDVI"</span></span>
<span><span class="co">#&gt; [1] "vi_step = 0.005"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optram_wetdry_coefficients.html">optram_wetdry_coefficients</a></span><span class="op">(</span><span class="va">full_df</span>,</span>
<span>                                   output_dir <span class="op">=</span> <span class="va">output_dir</span><span class="op">)</span></span>
<span><span class="va">edges_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"trapezoid_edges_lin.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_vi_str_cloud.html">plot_vi_str_cloud</a></span><span class="op">(</span><span class="va">full_df</span>,  edges_df <span class="op">=</span> <span class="va">edges_df</span>,</span>
<span>                        edge_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plot-linear-1.png" alt="Trapezoid scatterplot" width="90%"><p class="caption">
Trapezoid scatterplot
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lachish area trapezoid plot"</span>,</span>
<span>                            subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">meth</span>, <span class="st">"fitted"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trapezoid_lachish_"</span>,</span>
<span>                                             <span class="va">meth</span>, <span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">18</span>, height <span class="op">=</span> <span class="fl">12</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/trapezoid_lachish_linear.png"></p>
</div>
<div class="section level4">
<h4 id="show-exponential-fitted-trapezoid-plot">Show Exponential fitted trapezoid plot<a class="anchor" aria-label="anchor" href="#show-exponential-fitted-trapezoid-plot"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meth</span> <span class="op">&lt;-</span> <span class="st">"exponential"</span></span>
<span><span class="fu"><a href="../reference/optram_options.html">optram_options</a></span><span class="op">(</span><span class="st">"trapezoid_method"</span>, <span class="va">meth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "edge_points = TRUE"</span></span>
<span><span class="co">#&gt; [1] "feature_col = ID"</span></span>
<span><span class="co">#&gt; [1] "max_cloud = 12"</span></span>
<span><span class="co">#&gt; [1] "max_tbl_size = 1e+06"</span></span>
<span><span class="co">#&gt; [1] "period = full"</span></span>
<span><span class="co">#&gt; [1] "plot_colors = no"</span></span>
<span><span class="co">#&gt; [1] "remote = scihub"</span></span>
<span><span class="co">#&gt; [1] "rm.hi.str = FALSE"</span></span>
<span><span class="co">#&gt; [1] "rm.low.vi = FALSE"</span></span>
<span><span class="co">#&gt; [1] "SWIR_band = 11"</span></span>
<span><span class="co">#&gt; [1] "trapezoid_method = exponential"</span></span>
<span><span class="co">#&gt; [1] "veg_index = NDVI"</span></span>
<span><span class="co">#&gt; [1] "vi_step = 0.005"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optram_wetdry_coefficients.html">optram_wetdry_coefficients</a></span><span class="op">(</span><span class="va">full_df</span>,</span>
<span>                                     output_dir <span class="op">=</span> <span class="va">output_dir</span><span class="op">)</span></span>
<span><span class="va">edges_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"trapezoid_edges_exp.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_vi_str_cloud.html">plot_vi_str_cloud</a></span><span class="op">(</span><span class="va">full_df</span>,  edges_df <span class="op">=</span> <span class="va">edges_df</span>,</span>
<span>                        edge_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plot-exp-1.png" alt="Exponential fit trapezoid scatterplot" width="90%"><p class="caption">
Exponential fit trapezoid scatterplot
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lachish area trapezoid plot"</span>,</span>
<span>                            subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">meth</span>, <span class="st">"fitted"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trapezoid_lachish_"</span>,</span>
<span>                                            <span class="va">meth</span>, <span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">18</span>, height <span class="op">=</span> <span class="fl">12</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/trapezoid_lachish_exponential.png"></p>
</div>
<div class="section level4">
<h4 id="show-polynomial-fitted-trapezoid-plot">Show Polynomial fitted trapezoid plot<a class="anchor" aria-label="anchor" href="#show-polynomial-fitted-trapezoid-plot"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meth</span> <span class="op">&lt;-</span> <span class="st">"polynomial"</span></span>
<span><span class="fu"><a href="../reference/optram_options.html">optram_options</a></span><span class="op">(</span><span class="st">"trapezoid_method"</span>, <span class="va">meth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "edge_points = TRUE"</span></span>
<span><span class="co">#&gt; [1] "feature_col = ID"</span></span>
<span><span class="co">#&gt; [1] "max_cloud = 12"</span></span>
<span><span class="co">#&gt; [1] "max_tbl_size = 1e+06"</span></span>
<span><span class="co">#&gt; [1] "period = full"</span></span>
<span><span class="co">#&gt; [1] "plot_colors = no"</span></span>
<span><span class="co">#&gt; [1] "remote = scihub"</span></span>
<span><span class="co">#&gt; [1] "rm.hi.str = FALSE"</span></span>
<span><span class="co">#&gt; [1] "rm.low.vi = FALSE"</span></span>
<span><span class="co">#&gt; [1] "SWIR_band = 11"</span></span>
<span><span class="co">#&gt; [1] "trapezoid_method = polynomial"</span></span>
<span><span class="co">#&gt; [1] "veg_index = NDVI"</span></span>
<span><span class="co">#&gt; [1] "vi_step = 0.005"</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optram_wetdry_coefficients.html">optram_wetdry_coefficients</a></span><span class="op">(</span><span class="va">full_df</span>,</span>
<span>                                     output_dir <span class="op">=</span> <span class="va">output_dir</span><span class="op">)</span></span>
<span><span class="va">edges_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="st">"trapezoid_edges_poly.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_vi_str_cloud.html">plot_vi_str_cloud</a></span><span class="op">(</span><span class="va">full_df</span>,  edges_df <span class="op">=</span> <span class="va">edges_df</span>,</span>
<span>                        edge_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/plot-poly-1.png" alt="Polynomial fit trapezoid scatterplot" width="90%"><p class="caption">
Polynomial fit trapezoid scatterplot
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">pl</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Lachish area trapezoid plot"</span>,</span>
<span>                            subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">meth</span>, <span class="st">"fitted"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"trapezoid_lachish_"</span>,</span>
<span>                                             <span class="va">meth</span>, <span class="st">".png"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                width <span class="op">=</span> <span class="fl">18</span>, height <span class="op">=</span> <span class="fl">12</span>, units <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/trapezoid_lachish_polynomial.png"></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ma_combining_2022" class="csl-entry">
Ma, Chunfeng, Kasper Johansen, and Matthew F. McCabe. 2022.
<span>“Combining <span>Sentinel</span>-2 Data with an Optical-Trapezoid
Approach to Infer Within-Field Soil Moisture Variability and Monitor
Agricultural Production Stages.”</span> <em>Agricultural Water
Management</em> 274 (December): 107942. <a href="https://doi.org/10.1016/j.agwat.2022.107942" class="external-link">https://doi.org/10.1016/j.agwat.2022.107942</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
